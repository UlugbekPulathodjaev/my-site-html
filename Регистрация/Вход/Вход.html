<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login — Logistics Platform</title>
  <style>
    :root{
      --bg:#FFFFFF;
      --panel:#F3F4F6;
      --muted:#E5E7EB;
      --text:#111827;
      --accent:#3B82F6;
      --alt:#6B7280;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{height:100vh;display:grid;grid-template-columns:1fr 480px}
    .left{position:relative;overflow:hidden;background:var(--panel)}
    canvas#meshCanvas{width:100%;height:100%;display:block;opacity:0.65}
    .lang-switch{position:fixed;top:16px;right:16px;display:flex;gap:10px;z-index:20}
    .lang-switch button{padding:8px 14px;border-radius:8px;border:1px solid var(--muted);background:white;font-size:14px;cursor:pointer;transition:0.25s;}
    .lang-switch button.active{background:var(--accent);color:white;border-color:var(--accent)}
    .right{display:flex;align-items:center;justify-content:center;padding:40px}
    .card{width:100%;max-width:420px;background:var(--panel);padding:30px;border-radius:14px;box-shadow:0 8px 30px rgba(0,0,0,0.06)}
    h1{font-size:24px;margin-bottom:8px}
    .lead{color:var(--alt);margin-bottom:20px}
    label{font-size:13px;color:var(--alt);margin-bottom:4px;display:block}
    input{width:100%;padding:12px;border-radius:8px;border:1px solid var(--muted);margin-bottom:4px;font-size:15px}
    .btn{padding:12px;border-radius:10px;border:0;background:var(--accent);color:white;font-weight:600;cursor:pointer;width:100%;margin-top:8px}
    .small{font-size:13px;color:var(--alt);margin-top:10px;display:block;text-align:center}
    .small a{color:var(--accent)}

    /* Ошибки под полями */
    .field{display:block}
    .field-error input{border-color:#dc2626;background:#fff;box-shadow:0 0 0 1px rgba(220,38,38,0.18)}
    .field-error-message{margin-top:2px;margin-bottom:8px;display:flex;align-items:flex-start;gap:4px;font-size:11px;line-height:1.3;color:#dc2626}
    .field-error-message-icon{flex-shrink:0;width:14px;height:14px;border-radius:999px;background:#fee2e2;display:inline-flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:#dc2626}
    .field-error-message-text{flex:1}
    .global-message{margin-bottom:10px;font-size:12px;border-radius:8px;padding:6px 8px;display:none}
    .global-message--success{display:block;background:#ecfdf3;color:#166534;border:1px solid #bbf7d0}
    .global-message--error{display:block;background:#fef2f2;color:#b91c1c;border:1px solid #fecaca}
  </style>
</head>
<body>

<div class="lang-switch">
  <button id="lang-ru" class="active">RU</button>
  <button id="lang-en">EN</button>
</div>

<div class="wrap">
  <div class="left"><canvas id="meshCanvas"></canvas></div>

  <main class="right">
    <section class="card" id="loginCard">
      <h1 id="loginTitle">Вход</h1>
      <p class="lead" id="lead">Добро пожаловать обратно</p>

      <div id="globalMessage" class="global-message"></div>

      <div class="field" data-field="email">
        <label id="lab-email" for="email">Email</label>
        <input id="email" type="email">
        <div class="field-error-message" data-error-for="email" style="display:none;">
          <span class="field-error-message-icon">!</span>
          <span class="field-error-message-text"></span>
        </div>
      </div>

      <div class="field" data-field="password">
        <label id="lab-pass" for="password">Пароль</label>
        <input id="password" type="password">
        <div class="field-error-message" data-error-for="password" style="display:none;">
          <span class="field-error-message-icon">!</span>
          <span class="field-error-message-text"></span>
        </div>
      </div>

      <button class="btn" id="btn" disabled>Войти</button>
      <span class="small"><span id="no-account">Нет аккаунта?</span> <a id="signup" href="Регистрация.html">Создать</a></span>
    </section>
  </main>
</div>

<script>
(function(){
  const canvas=document.getElementById('meshCanvas');
  const ctx=canvas.getContext('2d');
  function resize(){canvas.width=canvas.clientWidth;canvas.height=canvas.clientHeight;}
  resize();window.addEventListener('resize',resize);
  const hubs=[];const COUNT_HUBS=20;
  for(let i=0;i<COUNT_HUBS;i++) hubs.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,alpha:0});
  const flows=[];const COUNT_GREEN=40;
  for(let i=0;i<COUNT_GREEN;i++){
    const from=hubs[Math.floor(Math.random()*COUNT_HUBS)];
    let to=hubs[Math.floor(Math.random()*COUNT_HUBS)];
    while(to===from) to=hubs[Math.floor(Math.random()*COUNT_HUBS)];
    flows.push({from,to,speed:0.5+Math.random()*0.4,x:from.x,y:from.y,alpha:0,visibleAlpha:0});
  }
  const transportDots=[];const COUNT_TRANSPORT=10;
  for(let i=0;i<COUNT_TRANSPORT;i++){
    const from=hubs[Math.floor(Math.random()*COUNT_HUBS)];
    let to=hubs[Math.floor(Math.random()*COUNT_HUBS)];
    while(to===from) to=hubs[Math.floor(Math.random()*COUNT_HUBS)];
    transportDots.push({x:from.x,y:from.y,from,to,speed:0.4+Math.random()*0.2,offset:Math.random()*Math.PI*2,alpha:0,visibleAlpha:0});
  }
  class Ship{
    constructor(start,end){this.start=start;this.end=end;this.progress=0;this.phase=Math.random()*Math.PI*2;this.amplitude=6+Math.random()*4;this.frequency=1+Math.random()*1.5;this.lastT=performance.now();this.pos={x:start.x,y:start.y};this.alpha=0;this.duration=this.getDuration();}
    getDuration(){const dx=this.end.x-this.start.x;const dy=this.end.y-this.start.y;const dist=Math.sqrt(dx*dx+dy*dy)||1;return Math.min(Math.max(dist/0.015,6000),25000);}
    update(now){const dt=now-this.lastT;this.lastT=now;this.progress+=dt/this.duration;const t=this.progress;const sx=this.start.x,sy=this.start.y;const ex=this.end.x,ey=this.end.y;const bx=sx+(ex-sx)*t;const by=sy+(ey-sy)*t;const dx=ex-sx,dy=ey-sy;const len=Math.sqrt(dx*dx+dy*dy)||1;const px=-dy/len,py=dx/len;const wave=Math.sin(t*this.frequency*Math.PI*2+this.phase)*this.amplitude;this.pos.x=bx+px*wave;this.pos.y=by+py*wave;if(this.alpha<1)this.alpha+=0.01;}
    draw(ctx,fade=1){ctx.save();ctx.translate(this.pos.x,this.pos.y);ctx.globalAlpha=fade*this.alpha;const top=6*1.2;const bottom=4;ctx.fillStyle='rgba(16,185,129,0.95)';ctx.beginPath();ctx.moveTo(-top,-4);ctx.lineTo(top,-4);ctx.lineTo(bottom,4);ctx.lineTo(-bottom,4);ctx.closePath();ctx.fill();ctx.restore();}
  }
  const ships=[];
  for(let i=0;i<3;i++){
    const from=hubs[Math.floor(Math.random()*hubs.length)];
    let to=hubs[Math.floor(Math.random()*hubs.length)];while(to===from) to=hubs[Math.floor(Math.random()*hubs.length)];
    ships.push(new Ship(from,to));
  }
  function drawTriangle(x,y,angle,size,alpha){ctx.save();ctx.translate(x,y);ctx.rotate(angle);ctx.shadowColor='rgba(0,0,0,0.22)';ctx.shadowBlur=8;ctx.shadowOffsetX=4;ctx.shadowOffsetY=6;ctx.globalAlpha=alpha;ctx.fillStyle='rgba(255,200,0,1)';ctx.beginPath();ctx.moveTo(0,-size);ctx.lineTo(-size*0.6,size);ctx.lineTo(size*0.6,size);ctx.closePath();ctx.fill();ctx.restore();}
  function loop(now){ctx.clearRect(0,0,canvas.width,canvas.height);
    flows.forEach(f=>{if(f.visibleAlpha<1) f.visibleAlpha+=0.005;ctx.beginPath();ctx.moveTo(f.from.x,f.from.y);ctx.lineTo(f.to.x,f.to.y);ctx.strokeStyle='rgba(59,130,246,'+f.visibleAlpha*0.18+')';ctx.lineWidth=1;ctx.stroke();const dx=f.to.x-f.x,dy=f.to.y-f.y;const dist=Math.sqrt(dx*dx+dy*dy);if(dist>1){f.x+=dx/dist*f.speed;f.y+=dy/dist*f.speed;}else{f.x=f.from.x;f.y=f.from.y;}ctx.beginPath();ctx.arc(f.x,f.y,3,0,Math.PI*2);ctx.fillStyle='rgba(16,185,129,0.8)';ctx.fill();});
    hubs.forEach(h=>{if(h.alpha<1) h.alpha+=0.005;ctx.beginPath();ctx.arc(h.x,h.y,6,0,Math.PI*2);ctx.fillStyle='rgba(59,130,246,'+h.alpha*0.8+')';ctx.fill();});
    transportDots.forEach(d=>{if(d.visibleAlpha<1) d.visibleAlpha+=0.005;const dx=d.to.x-d.x,dy=d.to.y-d.y;const dist=Math.sqrt(dx*dx+dy*dy);if(dist>0){d.x+=dx/dist*d.speed;d.y+=dy/dist*d.speed;}const blink=Math.abs(Math.sin(now*0.003+d.offset));const fade=dist<30?dist/30:1;const alpha=(0.4+0.6*blink)*fade*d.visibleAlpha;const angle=Math.atan2(dy,dx)+Math.PI/2;drawTriangle(d.x,d.y,angle,6,alpha);if(dist<1){d.x=d.from.x;d.y=d.from.y;}});
    ships.forEach(s=>{s.update(now);const dx=s.end.x-s.pos.x,dy=s.end.y-s.pos.y;const dist=Math.sqrt(dx*dx+dy*dy);const shipFade=dist<30?dist/30:1;s.draw(ctx,shipFade);if(s.progress>=1){s.start=s.end;let to=hubs[Math.floor(Math.random()*hubs.length)];let k=0;while(to===s.start&&k<10){to=hubs[Math.floor(Math.random()*hubs.length)];k++;}s.end=to;s.progress=0;}});
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);
})();
</script>

<script>
(function(){
  const ru=document.getElementById('lang-ru');
  const en=document.getElementById('lang-en');
  const L={
    ru:{title:"Вход",lead:"Добро пожаловать обратно",email:"Email",password:"Пароль",btn:"Войти",noacc:"Нет аккаунта?",signup:"Создать"},
    en:{title:"Log in",lead:"Welcome back",email:"Email",password:"Password",btn:"Log in",noacc:"No account?",signup:"Sign up"}
  };
  function setLang(lang){const t=L[lang];document.getElementById('loginTitle').textContent=t.title;document.getElementById('lead').textContent=t.lead;document.getElementById('lab-email').textContent=t.email;document.getElementById('lab-pass').textContent=t.password;document.getElementById('btn').textContent=t.btn;document.getElementById('no-account').textContent=t.noacc;document.getElementById('signup').textContent=t.signup;}
  ru.onclick=()=>{ru.classList.add('active');en.classList.remove('active');setLang('ru');};
  en.onclick=()=>{en.classList.add('active');ru.classList.remove('active');setLang('en');};
})();
</script>

<script>
// Проверка данных входа против сохранённого пользователя + ошибки под полями
(function(){
  const btn = document.getElementById('btn');
  const globalMessage = document.getElementById('globalMessage');
  const emailInput = document.getElementById('email');
  const passInput = document.getElementById('password');

  const errors = { email:'', password:'' };

  function setFieldError(name,msg){
    errors[name] = msg;
    const wrapper = document.querySelector('[data-field="'+name+'"]');
    const row = document.querySelector('[data-error-for="'+name+'"]');
    if(!wrapper || !row) return;
    const textEl = row.querySelector('.field-error-message-text');
    if(msg){
      wrapper.classList.add('field-error');
      textEl.textContent = msg;
      row.style.display = 'flex';
    }else{
      wrapper.classList.remove('field-error');
      textEl.textContent = '';
      row.style.display = 'none';
    }
    updateButtonState();
  }

  function hasAnyError(){
    return Object.values(errors).some(Boolean);
  }

  function allFilled(){
    return emailInput.value.trim() && passInput.value;
  }

  function updateButtonState(){
    btn.disabled = hasAnyError() || !allFilled();
  }

  function clearGlobalMessage(){
    globalMessage.className = 'global-message';
    globalMessage.textContent = '';
  }

  function isValidEmail(value){
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
  }

  function validateEmail(){
    const email = emailInput.value.trim();
    if(!email){
      setFieldError('email','Введите email.');
      return;
    }
    if(!isValidEmail(email)){
      setFieldError('email','Некорректный email.');
      return;
    }
    setFieldError('email','');
  }

  function validatePassword(){
    const pass = passInput.value;
    if(!pass){
      setFieldError('password','Введите пароль.');
      return;
    }
    setFieldError('password','');
  }

  emailInput.addEventListener('blur',validateEmail);
  passInput.addEventListener('blur',validatePassword);
  emailInput.addEventListener('input',function(){ validateEmail(); updateButtonState(); });
  passInput.addEventListener('input',function(){ validatePassword(); updateButtonState(); });

  btn.addEventListener('click',function(e){
    e.preventDefault();
    clearGlobalMessage();
    validateEmail();
    validatePassword();
    if(hasAnyError() || !allFilled()){
      globalMessage.className='global-message global-message--error';
      globalMessage.textContent='Проверьте корректность данных в форме.';
      return;
    }

    let stored = null;
    try {
      stored = localStorage.getItem('hermesUser');
    } catch(e) {
      console.error(e);
    }

    if(!stored){
      globalMessage.className='global-message global-message--error';
      globalMessage.textContent='Пользователь не найден. Сначала зарегистрируйтесь.';
      return;
    }

    let user = null;
    try {
      user = JSON.parse(stored);
    } catch(e){
      console.error(e);
      globalMessage.className='global-message global-message--error';
      globalMessage.textContent='Ошибка чтения сохранённых данных.';
      return;
    }

    if(user.email !== emailInput.value.trim() || user.pass !== passInput.value){
      setFieldError('password','Неверный email или пароль.');
      return;
    }

    globalMessage.className='global-message global-message--success';
    globalMessage.textContent='Вход выполнен успешно.';
    // window.location.href='../../clientpage.html';
  });

  updateButtonState();
})();
</script>

</body>
</html>
